version: "3.9"

services:

# Launching mongo service with its image 
  mongodb:
    image: mongo:latest
    volumes:
      - ./log:/log
    env_file: 
      - .env
    networks:
      - lufthansa_network
    container_name: container_mongo
    ports:
      - '27017:27017'


# Launching folder_api service, its container and creation of image for api requests and inserting data into mongodb 
  folder_api:
    build:
      context: ./folder_api
      dockerfile: ./Dockerfile
    command: python ./helpers.py
    depends_on:
      - mongodb 
    volumes:
      - ./log:/log
    env_file: 
      - .env
    networks:
      - lufthansa_network
    container_name: container_api


# Launching folder_fastapi service, its container and creation of image for getting data from mongodb using fastapi endpoints
  folder_fastapi:
    build:
      context: ./folder_fastapi
      dockerfile: ./Dockerfile
    command: python ./fast_api_endpoints.py
    depends_on:
      - folder_mongodb
    volumes:
      - ./log:/log
    env_file: 
      - .env
    networks:
      - lufthansa_network
    container_name: container_fastapi
    ports: 
      - "8000:8000"


# Launching folder_dash service, its container and creation of image for displaying the webb application
  folder_dash:
    build:
      context: ./folder_dash
      dockerfile: ./Dockerfile
    command: python ./dash_app.py
    depends_on:
      - folder_fastapi, folder_mongodb #  folder_mongodb service used because certain data is got directly from mongodb and not fastapi endpoints
    env_file: 
      - .env
    networks:
      - lufthansa_network
    container_name: container_dash
    ports: 
      - "8050:8000"

# Network unique pour tous les tests 
networks:
  lufthansa_network:

